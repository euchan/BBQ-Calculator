<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora BBQ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }

        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input[type="number"]:focus, input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            margin-bottom: 25px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .checkbox-group label:hover {
            background: #f5f5f5;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .result {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-top: 30px;
        }

        .result h2 {
            font-size: 18px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .result .total {
            font-size: 42px;
            font-weight: bold;
            margin: 10px 0;
        }

        .result .unit {
            font-size: 24px;
            opacity: 0.9;
        }

        .shopping-list {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.3);
        }

        .shopping-list h3 {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .shopping-list ul {
            list-style: none;
            text-align: left;
        }

        .shopping-list li {
            padding: 5px 0;
            font-size: 14px;
            opacity: 0.95;
        }

        .shopping-list li:before {
            content: "游댠 ";
            margin-right: 5px;
        }

        .add-custom {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .add-custom input[type="text"] {
            flex: 1;
        }

        .btn {
            padding: 10px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn:active {
            transform: translateY(1px);
        }

        .muted {
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>游꼤 Calculadora BBQ</h1>
        <p class="subtitle">Planifica tu barbacoa perfecta</p>

        <div class="input-group">
            <label for="pesoBase">Peso base por persona (gramos):</label>
            <input type="number" id="pesoBase" value="500" min="0" step="50">
        </div>

        <div class="input-group">
            <label for="mujeres">游놀 Mujeres adultas:</label>
            <input type="number" id="mujeres" value="0" min="0">
        </div>

        <div class="input-group">
            <label for="hombres">游녿 Hombres adultos:</label>
            <input type="number" id="hombres" value="0" min="0">
        </div>

        <div class="input-group">
            <label for="ninos">游놌 Ni침os:</label>
            <input type="number" id="ninos" value="0" min="0">
        </div>

        <div class="checkbox-group" id="checkboxGroup">
            <label><strong>Selecciona las carnes:</strong></label>
            <label>
                <input type="checkbox" id="alitas" value="alitas" class="meat-checkbox">
                <span>Alitas de pollo</span>
            </label>
            <label>
                <input type="checkbox" id="hamburguesas" value="hamburguesas">
                <span>Hamburguesas (150g cada una)</span>
            </label>
            <label>
                <input type="checkbox" id="pinchitos" value="pinchitos" class="meat-checkbox">
                <span>Pinchitos de pollo</span>
            </label>
            <label>
                <input type="checkbox" id="salchichas" value="salchichas" class="meat-checkbox">
                <span>Salchichas</span>
            </label>
            <label>
                <input type="checkbox" id="chuletas" value="chuletas" class="meat-checkbox">
                <span>Chuletas</span>
            </label>
            <label>
                <input type="checkbox" id="chorizo" value="chorizo">
                <span>Chorizo (medio por adulto)</span>
            </label>

            <!-- 츼rea para a침adir carnes personalizadas -->
            <div style="margin-top: 8px;">
                <div class="muted">A침adir nuevo tipo de carne:</div>
                <div class="add-custom">
                    <input type="text" id="otroCarneNombre" placeholder="Escribe el nombre (ej. costillas)">
                    <button id="agregarCarneBtn" class="btn" type="button">A침adir</button>
                </div>
                <small style="display:block; margin-top:6px; color:#666;">-> Puedes a침adir varios tipos; se repartir치n din치micamente el peso restante.</small>
            </div>
        </div>

        <div class="result">
            <h2>Total de carne a comprar</h2>
            <div class="total" id="totalCarne">0</div>
            <div class="unit" id="totalUnit">gramos</div>
            
            <div class="shopping-list" id="shoppingList" style="display: none;">
                <h3>Lista de compra:</h3>
                <ul id="listItems"></ul>
            </div>
        </div>
    </div>

    <script>
        // Formatea gramos a g o kg
        function formatearPeso(gramos) {
            if (isNaN(gramos) || gramos === 0) {
                return { valor: 0, unidad: 'g' };
            }
            if (Math.abs(gramos) >= 1000) {
                const kilos = gramos / 1000;
                return {
                    valor: kilos.toFixed(2),
                    unidad: 'kg'
                };
            } else {
                return {
                    valor: Math.round(gramos),
                    unidad: 'g'
                };
            }
        }

        // A침adir nuevo tipo de carne din치micamente
        function addCustomMeat(name) {
            const trimmed = name.trim();
            if (!trimmed) return;

            const checkboxGroup = document.getElementById('checkboxGroup');

            const label = document.createElement('label');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            // use a safe id
            const idSafe = 'custom-' + trimmed.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9\-]/g, '');
            checkbox.id = idSafe;
            checkbox.value = idSafe;
            checkbox.className = 'meat-checkbox';

            const span = document.createElement('span');
            span.textContent = trimmed;

            label.appendChild(checkbox);
            label.appendChild(span);

            // Insert the new label right before the add-custom area
            // find the add-custom container (we can insert before its parent div's next sibling)
            const addCustomDiv = document.querySelector('.add-custom').parentElement;
            checkboxGroup.insertBefore(label, addCustomDiv);

            // add event listener to the new checkbox
            checkbox.addEventListener('change', calcular);

            // clear input
            document.getElementById('otroCarneNombre').value = '';
            // recalculate
            calcular();
        }

        function calcular() {
            const pesoBase = parseFloat(document.getElementById('pesoBase').value) || parseFloat(document.getElementById('pesoBase').defaultValue) || 500;
            const mujeres = parseFloat(document.getElementById('mujeres').value) || 0;
            const hombres = parseFloat(document.getElementById('hombres').value) || 0;
            const ninos = parseFloat(document.getElementById('ninos').value) || 0;
            
            const totalPersonas = mujeres + hombres + ninos;
            const adultos = mujeres + hombres;
            
            const tieneHamburguesas = document.getElementById('hamburguesas').checked;
            const tieneChorizo = document.getElementById('chorizo').checked;

            // Obtener todas las checkboxes de tipos de carne (clase meat-checkbox)
            const meatCheckboxes = Array.from(document.querySelectorAll('.meat-checkbox'));

            // C치lculo base: Hombres peso completo, Mujeres 0.75, Ni침os 0.50
            let totalCarne = pesoBase * (hombres + (mujeres * 0.75) + (ninos * 0.50));
            
            // Ajustes seg칰n tipo de carne
            if (tieneHamburguesas) {
                totalCarne = totalCarne * 0.75;
            }
            
            if (document.getElementById('alitas') && document.getElementById('alitas').checked) {
                // Mantengo incremento de 10% para alitas como en la versi칩n original
                totalCarne = totalCarne * 1.10;
            }
            
            // Mostrar resultado con formato
            const pesoFormateado = formatearPeso(totalCarne);
            // pesoFormateado.valor puede ser string (kg) o number (g). Aseguramos string para mostrar con separadores
            document.getElementById('totalCarne').textContent = String(pesoFormateado.valor).toLocaleString('es-ES');
            document.getElementById('totalUnit').textContent = pesoFormateado.unidad;
            
            // Lista de compra
            const listItems = document.getElementById('listItems');
            const shoppingList = document.getElementById('shoppingList');
            listItems.innerHTML = '';
            
            // Consideramos seleccionados los tipos de carne (meat-checkbox) que est칠n checked
            const tiposCarneSeleccionados = meatCheckboxes.filter(cb => cb.checked);
            
            if (totalPersonas > 0 && (tieneHamburguesas || tieneChorizo || tiposCarneSeleccionados.length > 0)) {
                shoppingList.style.display = 'block';
                
                // Peso restante despu칠s de hamburguesas
                let pesoRestante = totalCarne;
                
                if (tieneHamburguesas) {
                    const numHamburguesas = totalPersonas;
                    const pesoHamburguesas = numHamburguesas * 150;
                    const pesoHamburguesasFormateado = formatearPeso(pesoHamburguesas);
                    listItems.innerHTML += `<li>Hamburguesas: ${numHamburguesas} unidades (${pesoHamburguesasFormateado.valor} ${pesoHamburguesasFormateado.unidad})</li>`;
                    pesoRestante = pesoRestante - pesoHamburguesas;
                }
                
                if (tieneChorizo && adultos > 0) {
                    const numChorizos = Math.ceil(adultos * 0.5);
                    listItems.innerHTML += `<li>Chorizo: ${numChorizos} unidades (medio por adulto)</li>`;
                }
                
                // Distribuir el peso restante entre los dem치s tipos de carne seleccionados
                if (tiposCarneSeleccionados.length > 0) {
                    // Si el peso restante es negativo (caso improbable), forzamos a 0
                    if (pesoRestante < 0) pesoRestante = 0;
                    const pesoPorTipo = pesoRestante / tiposCarneSeleccionados.length;
                    
                    tiposCarneSeleccionados.forEach(cb => {
                        // Obtener el texto del span hermano (el nombre de la carne)
                        let nombre = '';
                        const parent = cb.parentElement;
                        if (parent) {
                            const span = parent.querySelector('span');
                            nombre = span ? span.textContent : cb.value;
                        } else {
                            nombre = cb.value;
                        }
                        const pesoTipoFormateado = formatearPeso(pesoPorTipo);
                        listItems.innerHTML += `<li>${nombre} (${pesoTipoFormateado.valor} ${pesoTipoFormateado.unidad})</li>`;
                    });
                } else if (!tieneHamburguesas && !tieneChorizo) {
                    // Si no hay ning칰n tipo de carne seleccionado y no hay hamburguesas ni chorizo
                    listItems.innerHTML += `<li>Sin tipos de carne seleccionados (selecciona al menos uno)</li>`;
                }
            } else {
                shoppingList.style.display = 'none';
            }
        }

        // Cuando un input number tiene "0" y el usuario hace focus, se borra el 0 autom치ticamente.
        function attachNumberInputBehavior() {
            const numberInputs = Array.from(document.querySelectorAll('input[type="number"]'));
            numberInputs.forEach(input => {
                // On focus: remove a single "0" to let user type quickly
                input.addEventListener('focus', (e) => {
                    // Solo eliminar si el valor es exactamente "0"
                    if (e.target.value === "0") {
                        e.target.value = "";
                    }
                });
                // On blur: if empty, restore the default value (so pesoBase vuelve a su 500 por defecto)
                input.addEventListener('blur', (e) => {
                    if (e.target.value === "") {
                        // Use defaultValue if present, otherwise set to 0
                        e.target.value = (e.target.defaultValue !== undefined && e.target.defaultValue !== "") ? e.target.defaultValue : "0";
                    }
                    calcular();
                });
            });
        }

        // Event listeners iniciales
        document.getElementById('pesoBase').addEventListener('input', calcular);
        document.getElementById('mujeres').addEventListener('input', calcular);
        document.getElementById('hombres').addEventListener('input', calcular);
        document.getElementById('ninos').addEventListener('input', calcular);
        document.getElementById('alitas').addEventListener('change', calcular);
        document.getElementById('hamburguesas').addEventListener('change', calcular);
        document.getElementById('pinchitos').addEventListener('change', calcular);
        document.getElementById('salchichas').addEventListener('change', calcular);
        document.getElementById('chuletas').addEventListener('change', calcular);
        document.getElementById('chorizo').addEventListener('change', calcular);

        // A침adir nuevos tipos de carne
        document.getElementById('agregarCarneBtn').addEventListener('click', () => {
            const nombre = document.getElementById('otroCarneNombre').value;
            if (!nombre.trim()) return;
            addCustomMeat(nombre);
        });
        // Soporta Enter en el campo de texto
        document.getElementById('otroCarneNombre').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                const nombre = e.target.value;
                if (!nombre.trim()) return;
                addCustomMeat(nombre);
            }
        });

        // Attach behavior to number inputs (clear leading 0 on focus)
        attachNumberInputBehavior();

        // Calcular al cargar
        calcular();
    </script>
</body>
</html>
